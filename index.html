<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pickleball Mix n Match</title>

<style>
:root{
  --page-bg:#f5f6f7;
  --card-bg:#0f2435;
  --card-text:#e7f3ff;
  --muted:#9aa6b4;
  --accent:#d4af37;
  --radius:10px;
  --input-height:48px;
}
*,*::before,*::after{box-sizing:border-box;}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Arial,sans-serif;
  background:var(--page-bg);
}
.banner{
  position:fixed;top:0;left:0;right:0;height:46px;
  display:flex;align-items:center;justify-content:center;
  background:var(--card-bg);color:var(--card-text);
  font-weight:700;font-size:13px;
}
body{padding-top:46px;}
.wrap{max-width:1100px;margin:0 auto;padding:12px 16px;}
.card{
  background:var(--card-bg);
  color:var(--card-text);
  border-radius:var(--radius);
  padding:16px;
  margin-bottom:12px;
}
.title{font-weight:700;margin-bottom:12px;}
label{font-size:12.5px;color:var(--muted);display:block;margin-bottom:6px;}
input,textarea{
  width:100%;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.05);
  color:var(--card-text);
}
textarea{min-height:120px;resize:vertical;}
.btn{
  height:var(--input-height);
  padding:0 16px;
  border-radius:8px;
  font-weight:700;
  border:none;
  cursor:pointer;
}
.btn.primary{background:var(--accent);color:#102238;}
.action-row{display:flex;gap:10px;justify-content:flex-end;margin-top:12px;}
.round{
  background:rgba(255,255,255,0.03);
  padding:12px;
  border-radius:8px;
  margin-top:10px;
}
.match{padding:6px 0;}
.idle{font-size:12.5px;color:var(--muted);margin-top:6px;}
</style>
</head>

<body>
<div class="banner">Pickleball Mix n Match</div>

<div class="wrap">

<div class="card">
  <div class="title">Setup</div>
  <label>Number of Courts</label>
  <input id="courts" type="number" min="1" value="2">
  <div class="action-row">
    <button class="btn primary" onclick="showEntry()">Next: Enter Players</button>
  </div>
</div>

<div class="card" id="entryCard" style="display:none;">
  <div class="title">Enter Players</div>
  <label>Women (one per line)</label>
  <textarea id="women"></textarea>
  <label style="margin-top:8px;">Men (one per line)</label>
  <textarea id="men"></textarea>
  <div class="action-row">
    <button class="btn primary" onclick="savePlayers()">Generate Fixtures</button>
  </div>
</div>

<div class="card" id="fixturesCard" style="display:none;">
  <div class="title">Fixtures</div>
  <div id="fixtures"></div>
</div>

</div>

<script>
let players=[], pairHistory={}, idleCount={}
const ROUND_LIMIT=8

function showEntry(){ entryCard.style.display='block' }

function savePlayers(){
  players=[]; pairHistory={}; idleCount={}
  let id=1
  women.value.split('\n').map(s=>s.trim()).filter(Boolean)
    .forEach(n=>{ players.push({id,name:n,gender:'W'}); idleCount[id++]=0 })
  men.value.split('\n').map(s=>s.trim()).filter(Boolean)
    .forEach(n=>{ players.push({id,name:n,gender:'M'}); idleCount[id++]=0 })
  generateRounds()
}

function pairKey(a,b){ return [a.id,b.id].sort().join('-') }

function generateRounds(){
  fixtures.innerHTML=''
  const numCourts=+courts.value
  const activeCount=numCourts*4

  for(let round=1; round<=ROUND_LIMIT; round++){
    let html=`<div class="round"><strong>Round ${round}</strong>`

    // ---- Idle selection (least-idled first)
    const sorted=[...players].sort((a,b)=>
      (idleCount[a.id]-idleCount[b.id])||(a.id-b.id)
    )
    const idle=sorted.slice(0, players.length-activeCount)
    idle.forEach(p=>idleCount[p.id]++)
    const active=sorted.slice(players.length-activeCount)

    // ---- Build teams until courts are full
    const teams=[]
    const used=new Set()

    const menA=()=>active.filter(p=>p.gender==='M' && !used.has(p.id))
    const womenA=()=>active.filter(p=>p.gender==='W' && !used.has(p.id))

    while(teams.length < numCourts*2){
      // 1. Prefer MW with least-used history
      let bestMW=null
      menA().forEach(m=>{
        womenA().forEach(w=>{
          const k=pairKey(m,w)
          const usedCt=pairHistory[k]||0
          if(!bestMW || usedCt < bestMW.used){
            bestMW={m,w,used:usedCt}
          }
        })
      })
      if(bestMW){
        teams.push({a:bestMW.m,b:bestMW.w})
        used.add(bestMW.m.id); used.add(bestMW.w.id)
        pairHistory[pairKey(bestMW.m,bestMW.w)]=(bestMW.used||0)+1
        continue
      }

      // 2. Fallback WW
      const w=womenA()
      if(w.length>=2){
        teams.push({a:w[0],b:w[1]})
        used.add(w[0].id); used.add(w[1].id)
        continue
      }

      // 3. Fallback MM
      const m=menA()
      if(m.length>=2){
        teams.push({a:m[0],b:m[1]})
        used.add(m[0].id); used.add(m[1].id)
        continue
      }

      // Should never reach here
      break
    }

    // ---- Render matches
    for(let i=0;i+1<teams.length;i+=2){
      html+=`<div class="match">
        (${teams[i].a.name} + ${teams[i].b.name})
        vs
        (${teams[i+1].a.name} + ${teams[i+1].b.name})
      </div>`
    }

    html+=`<div class="idle">Idle: ${idle.map(p=>p.name).join(', ')}</div></div>`
    fixtures.innerHTML+=html
  }

  fixturesCard.style.display='block'
}
</script>
</body>
</html>
