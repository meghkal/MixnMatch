<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mix n Match — Standalone</title>

<style>
:root{
  --page-bg:#f5f6f7;
  --card-bg:#0f2435;
  --card-text:#e7f3ff;
  --muted:#9aa6b4;
  --accent:#d4af37;
  --radius:10px;
  --input-height:44px;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:Inter,system-ui,Arial,sans-serif;
  background:var(--page-bg);
}
.banner{
  position:fixed;top:0;left:0;right:0;height:46px;
  display:flex;align-items:center;justify-content:center;
  background:var(--card-bg);color:var(--card-text);
  font-weight:700;font-size:13px;
}
body{padding-top:46px;}
.wrap{max-width:1100px;margin:0 auto;padding:12px 16px;}

.card{
  background:var(--card-bg);
  color:var(--card-text);
  border-radius:var(--radius);
  padding:16px;
  margin-bottom:12px;
}
.title{font-weight:700;margin-bottom:12px;}

.btn{
  height:var(--input-height);
  padding:0 16px;
  border-radius:8px;
  font-weight:700;
  border:none;
  cursor:pointer;
}
.btn.primary{background:var(--accent);color:#102238;}
.btn.ghost{background:transparent;color:var(--card-text);border:1px solid rgba(255,255,255,0.12);}

.round{background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;margin-top:12px;}
.match{padding:6px 0;font-size:14.5px;}
.idle{font-size:12.5px;color:var(--muted);margin-top:6px;font-style:italic;}

.score-row{display:flex;gap:8px;margin-top:4px;}
.score-row input{width:64px;text-align:center;}
</style>
</head>

<body>
<div class="banner">Mix n Match — Standalone</div>
<div class="wrap">

<div class="card">
  <div class="title">Setup</div>
  Courts <input id="courts" type="number" value="2">
  Players <input id="count" type="number" value="12">
  <button class="btn primary" onclick="startEntry()">Next</button>
</div>

<div class="card" id="entryCard" style="display:none;">
  <div class="title">Enter Players</div>
  <div id="entry"></div>
  <button class="btn primary" onclick="savePlayers()">Generate Fixtures</button>
</div>

<div class="card" id="fixturesCard" style="display:none;">
  <div class="title">Fixtures</div>
  <div id="fixtures"></div>
</div>

</div>

<script>
const ROUND_LIMIT = 8;
let players=[], rounds=[];

function startEntry(){
  entry.innerHTML='';
  for(let i=1;i<=count.value;i++){
    entry.innerHTML+=`
      <input id="n${i}" placeholder="Player ${i}">
      <select id="g${i}">
        <option value="">Gender</option>
        <option value="W">Woman</option>
        <option value="M">Man</option>
      </select><br>`;
  }
  entryCard.style.display='block';
}

function savePlayers(){
  players=[];
  for(let i=1;i<=count.value;i++){
    players.push({
      id:i,
      name:document.getElementById(`n${i}`).value||`Player ${i}`,
      gender:document.getElementById(`g${i}`).value,
      played:0,
      idled:0,
      lastPlayed:-1
    });
  }
  buildRounds();
}

function buildRounds(){
  fixtures.innerHTML='';
  rounds=[];
  const maxCourts=+courts.value;

  for(let r=1;r<=ROUND_LIMIT;r++){
    let women=players.filter(p=>p.gender==='W')
      .sort((a,b)=>
        (a.lastPlayed===r-1)-(b.lastPlayed===r-1) ||
        a.played-b.played ||
        a.idled-b.idled
      );

    let men=players.filter(p=>p.gender==='M')
      .sort((a,b)=>a.played-b.played||a.idled-b.idled);

    let teams=[];

    // 1. Mixed doubles
    while(women.length && men.length){
      teams.push([women.shift(), men.shift()]);
    }

    // 2. Women-Women
    while(women.length>=2){
      teams.push([women.shift(), women.shift()]);
    }

    // 3. Men-Men
    while(men.length>=2){
      teams.push([men.shift(), men.shift()]);
    }

    teams=teams.slice(0,maxCourts*2);

    let active=teams.flat();
    let idle=players.filter(p=>!active.includes(p));

    active.forEach(p=>{
      p.played++;
      p.lastPlayed=r;
    });
    idle.forEach(p=>p.idled++);

    rounds.push({round:r,teams,idle});

    let html=`<div class="round"><strong>Round ${r}</strong>`;
    for(let i=0;i+1<teams.length;i+=2){
      html+=`<div class="match">
        (${teams[i][0].name}+${teams[i][1].name})
        vs
        (${teams[i+1][0].name}+${teams[i+1][1].name})
      </div>`;
    }
    html+=`<div class="idle">Idle: ${idle.map(p=>p.name).join(', ')}</div></div>`;
    fixtures.innerHTML+=html;
  }

  fixturesCard.style.display='block';
}
</script>
</body>
</html>
